{"version":3,"file":"no-mix-dearu-desumasu.js","names":["Object","defineProperty","exports","value","PreferTypes","_textlintRuleHelper","require","_BodyMixedChecker","_interopRequireDefault","_HeaderMixedChecker","_ListMixedChecker","e","__esModule","default","DESUMASU","DEARU","defaultOptions","preferInHeader","preferInBody","preferInList","strict","allowedTypes","assertPreferOption","preferType","includes","Error","map","type","module","noMixedDearuDesumasu","context","options","Syntax","getSource","helper","RuleHelper","ignoreManager","IgnoreNodeManager","isStrict","undefined","bodyChecker","BodyMixedChecker","preferDesumasu","preferDearu","headerChecker","HeaderMixedChecker","listChecker","ListMixedChecker","Header","node","text","check","ListItem","Paragraph","ignoredNodeTypes","Link","Code","Image","BlockQuote","Emphasis","isChildNode","ignoreChildrenByTypes","Document","Promise","all","checkout"],"sources":["../src/no-mix-dearu-desumasu.js"],"sourcesContent":["// LICENSE : MIT\n\"use strict\";\nimport { RuleHelper, IgnoreNodeManager } from \"textlint-rule-helper\";\nimport BodyMixedChecker from \"./BodyMixedChecker\";\nimport HeaderMixedChecker from \"./HeaderMixedChecker\";\nimport ListMixedChecker from \"./ListMixedChecker\";\n\nexport const PreferTypes = {\n    DESUMASU: \"ですます\",\n    DEARU: \"である\"\n};\n// デフォルトでその項目で多く出現している方を優先します。\n// 明示的にpreferの設定した場合は、そちらを優先した内容をエラーとして表示します。\nconst defaultOptions = {\n    preferInHeader: \"\", // \"である\" or \"ですます\"\n    preferInBody: \"\", // \"である\" or \"ですます\"\n    preferInList: \"\", // \"である\" or \"ですます\"\n    // 文末以外でも、敬体(ですます調)と常体(である調)を厳しくチェックするかどうか\n    strict: false\n};\n\nconst allowedTypes = [/*auto*/ \"\", PreferTypes.DESUMASU, PreferTypes.DEARU];\nconst assertPreferOption = (preferType) => {\n    if (!preferType) {\n        return;\n    }\n    if (!allowedTypes.includes(preferType)) {\n        throw new Error(`preferInHeader, preferInBody, preferInList は ${allowedTypes.map((type) => {\n            return `\"${type}\"`;\n        })} のどれかである必要があります。 \n\n実際の値: \"${preferType}\"`);\n    }\n};\n\nmodule.exports = function noMixedDearuDesumasu(context, options = defaultOptions) {\n    const { Syntax, getSource } = context;\n    const helper = new RuleHelper(context);\n    const ignoreManager = new IgnoreNodeManager();\n    const isStrict = options.strict !== undefined ? options.strict : defaultOptions.strict;\n    assertPreferOption(options.preferInHeader);\n    assertPreferOption(options.preferInBody);\n    assertPreferOption(options.preferInList);\n    const bodyChecker = new BodyMixedChecker(context, {\n        preferDesumasu: options.preferInBody === PreferTypes.DESUMASU,\n        preferDearu: options.preferInBody === PreferTypes.DEARU,\n        isStrict\n    });\n    const headerChecker = new HeaderMixedChecker(context, {\n        preferDesumasu: options.preferInHeader === PreferTypes.DESUMASU,\n        preferDearu: options.preferInHeader === PreferTypes.DEARU,\n        isStrict\n    });\n    const listChecker = new ListMixedChecker(context, {\n        preferDesumasu: options.preferInList === PreferTypes.DESUMASU,\n        preferDearu: options.preferInList === PreferTypes.DEARU,\n        isStrict\n    });\n    return {\n        // 見出し\n        [Syntax.Header](node) {\n            const text = getSource(node);\n            headerChecker.check(node, text);\n        },\n        // 箇条書き\n        [Syntax.ListItem](node) {\n            const text = getSource(node);\n            listChecker.check(node, text);\n        },\n        // 本文\n        [Syntax.Paragraph](node) {\n            const ignoredNodeTypes = [Syntax.Link, Syntax.Code, Syntax.Image, Syntax.BlockQuote, Syntax.Emphasis];\n            // 無視リストのTypeが親にある場合は無視する\n            if (helper.isChildNode(node, ignoredNodeTypes)) {\n                return;\n            }\n            // 見出しと箇条書きは別途チェックするので Header > Str などは無視する\n            if (helper.isChildNode(node, [Syntax.Header, Syntax.ListItem])) {\n                return;\n            }\n            // childrenに無視するtypeがいた場合は無視リストに加える\n            ignoreManager.ignoreChildrenByTypes(node, ignoredNodeTypes);\n            // check\n            const text = getSource(node);\n            bodyChecker.check(node, text);\n        },\n        [Syntax.Document + \":exit\"]() {\n            return Promise.all([\n                bodyChecker.checkout(ignoreManager),\n                headerChecker.checkout(ignoreManager),\n                listChecker.checkout(ignoreManager)\n            ]);\n        }\n    };\n};\n"],"mappings":"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","ignoreList":[]}