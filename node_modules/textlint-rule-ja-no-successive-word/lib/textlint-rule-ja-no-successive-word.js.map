{"version":3,"sources":["../src/textlint-rule-ja-no-successive-word.js"],"names":["DefaultOptions","allowOnomatopee","allow","isOnomatopee","str","test","isNumberToken","token","pos","pos_detail_1","context","options","undefined","Syntax","RuleError","report","getSource","Str","node","text","then","tokens","prevToken","reportIfMatch","nextToken","prevWord","surface_form","currentWord","length","index","Math","max","word_position","forEach"],"mappings":"AAAA;AACA;;;;;;;AACA;;AACA;;AAEA,IAAMA,cAAc,GAAG;AACnB;AACA;AACA;AACA;AACAC,EAAAA,eAAe,EAAE,IALE;AAOnB;AACA;AACAC,EAAAA,KAAK,EAAE;AATY,CAAvB;;AAYA,SAASC,YAAT,CAAsBC,GAAtB,EAA2B;AACvB,SAAO,eAAeC,IAAf,CAAoBD,GAApB,CAAP;AACH;AAED;;;;;;;;AAMA,SAASE,aAAT,CAAuBC,KAAvB,EAA8B;AAC1B,SAAOA,KAAK,CAACC,GAAN,KAAc,IAAd,IAAsBD,KAAK,CAACE,YAAN,KAAuB,GAApD;AACH;;AAEc,kBAAUC,OAAV,EAAiC;AAAA,MAAdC,OAAc,uEAAJ,EAAI;AAC5C,MAAMV,eAAe,GAAGU,OAAO,CAACV,eAAR,KAA4BW,SAA5B,GAAwCD,OAAO,CAACV,eAAhD,GAClBD,cAAc,CAACC,eADrB;AAEA,MAAMC,KAAK,GAAGS,OAAO,CAACT,KAAR,IAAiBF,cAAc,CAACE,KAA9C;AACA,MAAM;AAAEW,IAAAA,MAAF;AAAUC,IAAAA,SAAV;AAAqBC,IAAAA,MAArB;AAA6BC,IAAAA;AAA7B,MAA2CN,OAAjD;AACA,SAAO;AACH,KAACG,MAAM,CAACI,GAAR,EAAaC,IAAb,EAAmB;AACf,UAAMC,IAAI,GAAGH,SAAS,CAACE,IAAD,CAAtB;AACA,aAAO,yBAASC,IAAT,EAAeC,IAAf,CAAoBC,MAAM,IAAI;AACjC,YAAIC,SAAS,GAAG,EAAhB;;AACA,YAAMC,aAAa,GAAG,CAACD,SAAD,EAAYE,SAAZ,KAA0B;AAC5C,cAAMC,QAAQ,GAAGH,SAAS,CAACI,YAA3B;AACA,cAAMC,WAAW,GAAGH,SAAS,CAACE,YAA9B;;AACA,cAAI,IAAIxB,KAAK,CAAC0B,MAAV,IAAoB,IAAI,wCAAcD,WAAd,EAA2BzB,KAA3B,EAAkC0B,MAA9D,EAAsE;AAClE;AACH;;AACD,cAAIH,QAAQ,KAAKE,WAAjB,EAA8B;AAC1B;AACH,WAR2C,CAS5C;AACA;AACA;;;AACA,cAAIrB,aAAa,CAACgB,SAAD,CAAb,IAA4BhB,aAAa,CAACkB,SAAD,CAA7C,EAA0D;AACtD;AACH;;AACD,cAAIvB,eAAe,IAAIE,YAAY,CAACsB,QAAD,CAA/B,IAA6CtB,YAAY,CAACwB,WAAD,CAA7D,EAA4E;AACxE;AACH;;AACD,cAAME,KAAK,GAAGC,IAAI,CAACC,GAAL,CAASP,SAAS,CAACQ,aAAV,GAA0B,CAAnC,EAAsC,CAAtC,CAAd;AACAjB,UAAAA,MAAM,CAACG,IAAD,EAAO,IAAIJ,SAAJ,aAAkBa,WAAlB,+FAAkD;AAC3DE,YAAAA;AAD2D,WAAlD,CAAP,CAAN;AAGH,SAtBD;;AAuBAR,QAAAA,MAAM,CAACY,OAAP,CAAe1B,KAAK,IAAI;AACpBgB,UAAAA,aAAa,CAACD,SAAD,EAAYf,KAAZ,CAAb;AACAe,UAAAA,SAAS,GAAGf,KAAZ;AACH,SAHD;AAIH,OA7BM,CAAP;AA8BH;;AAjCE,GAAP;AAmCH;;AAAA","sourcesContent":["// LICENSE : MIT\n\"use strict\";\nimport { matchPatterns } from \"@textlint/regexp-string-matcher\";\nimport { tokenize } from \"kuromojin\";\n\nconst DefaultOptions = {\n    // オノマトペを許可する\n    // 制限: オノマトペを判定する方法がないため、同じカタカナの語が連続したものをオノマトペとして扱う\n    // 例) カクカク、ドキドキ、ビリビリ\n    // https://ja.wikipedia.org/wiki/%E6%93%AC%E5%A3%B0%E8%AA%9E\n    allowOnomatopee: true,\n    \n    // 許可する単語\n    // RegExp-like Stringを使用可能\n    allow: []\n};\n\nfunction isOnomatopee(str) {\n    return /^[ァ-ロワヲンー]*$/.test(str);\n}\n\n/**\n * 漢数字かどうかを判定する\n * https://azu.github.io/morpheme-match/?text=%E5%80%A4%E3%81%AF%E4%B9%9D%E4%B9%9D%E3%81%A7%E3%81%99%E3%80%82\n * @param {import(\"kuromojin\").KuromojiToken} token\n * @returns {boolean}\n */\nfunction isNumberToken(token) {\n    return token.pos === \"名詞\" && token.pos_detail_1 === \"数\";\n}\n\nexport default function (context, options = {}) {\n    const allowOnomatopee = options.allowOnomatopee !== undefined ? options.allowOnomatopee\n        : DefaultOptions.allowOnomatopee;\n    const allow = options.allow || DefaultOptions.allow;\n    const { Syntax, RuleError, report, getSource } = context;\n    return {\n        [Syntax.Str](node) {\n            const text = getSource(node);\n            return tokenize(text).then(tokens => {\n                let prevToken = {};\n                const reportIfMatch = (prevToken, nextToken) => {\n                    const prevWord = prevToken.surface_form;\n                    const currentWord = nextToken.surface_form;\n                    if (0 < allow.length && 0 < matchPatterns(currentWord, allow).length) {\n                        return;\n                    }\n                    if (prevWord !== currentWord) {\n                        return;\n                    }\n                    // 漢数字は例外とする\n                    // 例) 値は\"九九\"です。\n                    // https://azu.github.io/morpheme-match/?text=%E5%80%A4%E3%81%AF%E4%B9%9D%E4%B9%9D%E3%81%A7%E3%81%99%E3%80%82\n                    if (isNumberToken(prevToken) && isNumberToken(nextToken)) {\n                        return;\n                    }\n                    if (allowOnomatopee && isOnomatopee(prevWord) && isOnomatopee(currentWord)) {\n                        return;\n                    }\n                    const index = Math.max(nextToken.word_position - 1, 0);\n                    report(node, new RuleError(`\"${currentWord}\" が連続して2回使われています。`, {\n                        index\n                    }));\n                };\n                tokens.forEach(token => {\n                    reportIfMatch(prevToken, token);\n                    prevToken = token;\n                });\n            });\n        }\n    }\n};\n"],"file":"textlint-rule-ja-no-successive-word.js"}