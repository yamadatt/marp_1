{"version":3,"file":"1.1.3.js","names":["_analyzeDesumasuDearu","require","module","exports","context","Syntax","RuleError","report","getSource","desumasuList","dearuList","withPointList","withoutPointList","resetList","reportPointResult","nodeList","shouldUsePoint","forEach","node","message","reportDesumaruDearuResult","list","desumasu","dearu","matches","match","value","line","lineNumber","column","columnIndex","countingPoint","length","countingDesumasuDearu","desumasuCount","reduce","count","dearuCount","List","ListItem","text","matchPointReg","test","push","retDesumasu","analyzeDesumasu","retDearu","analyzeDearu"],"sources":["../src/1.1.3.js"],"sourcesContent":["// LICENSE : MIT\n\"use strict\";\n/*\n1.1.3.箇条書き\n\n基本的に本文の文体に合わせます。\nただし、本文が「敬体」である場合、箇条書きに「常体」または「体言止め」も使う場合があります。\n一般読者向け の文書で、本文が敬体である場合、多くの場合、箇条書きでも敬体を使います。\n本文が「常体」である場合、箇条書きには「常体」または「体言止め」を使います。「敬体」は使いません。\nいずれの場合も、ひとまとまりの箇条書きでは、敬体と常体を混在させません。文末に句点(。)を付けるかどうかも統一します。\n */\nimport { analyzeDesumasu, analyzeDearu } from \"analyze-desumasu-dearu\";\nmodule.exports = function (context) {\n    let { Syntax, RuleError, report, getSource } = context;\n    let desumasuList = [];\n    let dearuList = [];\n    // 。付きのListItem\n    let withPointList = [];\n    // 。なしのListItem\n    let withoutPointList = [];\n\n    function resetList() {\n        dearuList = [];\n        desumasuList = [];\n        withPointList = [];\n        withoutPointList = [];\n    }\n\n    function reportPointResult(nodeList, { shouldUsePoint }) {\n        nodeList.forEach((node) => {\n            let message;\n            if (shouldUsePoint) {\n                message = `箇条書きの文末に句点(。)を付けて下さい。\\n箇条書きの文末に句点(。)を付けるかを統一します。`;\n            } else {\n                message = `箇条書きの文末から句点(。)を外して下さい。\\n箇条書きの文末に句点(。)を付けるかを統一します。`;\n            }\n            report(node, new RuleError(message));\n        });\n    }\n\n    function reportDesumaruDearuResult(list, { desumasu, dearu }) {\n        list.forEach(({ node, matches }) => {\n            matches.forEach((match) => {\n                let message;\n                if (desumasu) {\n                    message = `箇条書きを敬体(ですます調)に統一して下さい。\\nひとまとまりの箇条書きでは、敬体と常体を混在させません。\\n\"${match.value}\"が常体(である調)です。`;\n                } else if (dearu) {\n                    message = `箇条書きを常体(である調)に統一して下さい。\\nひとまとまりの箇条書きでは、敬体と常体を混在させません。\\n\"${match.value}\"が敬体(ですます調)です。`;\n                }\n                report(\n                    node,\n                    new RuleError(message, {\n                        line: match.lineNumber - 1,\n                        column: match.columnIndex\n                    })\n                );\n            });\n        });\n    }\n\n    // 末尾に。があるかが統一されているのチェック\n    function countingPoint(withPointList, withoutPointList) {\n        if (withPointList.length === 0 || withoutPointList.length === 0) {\n            return;\n        }\n        if (withPointList.length > withoutPointList.length) {\n            // 。ありに統一\n            reportPointResult(withoutPointList, {\n                shouldUsePoint: true\n            });\n        } else if (withPointList.length < withoutPointList.length) {\n            // 。なしに統一\n            reportPointResult(withPointList, {\n                shouldUsePoint: false\n            });\n        } else {\n            // 。ありに統一\n            reportPointResult(withoutPointList, {\n                shouldUsePoint: true\n            });\n        }\n    }\n\n    // 敬体(ですます調)あるいは常体(である調)なのかのチェック\n    function countingDesumasuDearu(desumasuList, dearuList) {\n        let desumasuCount = desumasuList.reduce((count, { matches }) => count + matches.length, 0);\n        let dearuCount = dearuList.reduce((count, { matches }) => count + matches.length, 0);\n        if (desumasuCount === 0 || dearuCount === 0) {\n            return;\n        }\n        // ですます優先\n        if (desumasuCount > dearuCount) {\n            reportDesumaruDearuResult(dearuList, {\n                desumasu: true\n            });\n        } else if (desumasuCount < dearuCount) {\n            // である優先\n            reportDesumaruDearuResult(desumasuList, {\n                dearu: true\n            });\n        } else {\n            // 同等の場合はですます優先\n            reportDesumaruDearuResult(dearuList, {\n                desumasu: true\n            });\n        }\n    }\n\n    return {\n        [Syntax.List](node) {\n            resetList();\n        },\n        [Syntax.ListItem](node) {\n            let text = getSource(node);\n            // 末尾に。があるかが統一されているのチェック\n            let matchPointReg = /。(\\s*?)$/;\n            if (matchPointReg.test(text)) {\n                // 。あり\n                withPointList.push(node);\n            } else {\n                // 。なし\n                withoutPointList.push(node);\n            }\n            // 敬体(ですます調)あるいは常体(である調)なのかのチェック\n            let retDesumasu = analyzeDesumasu(text);\n            if (retDesumasu.length > 0) {\n                desumasuList.push({\n                    node: node,\n                    matches: retDesumasu\n                });\n            }\n            let retDearu = analyzeDearu(text);\n            if (retDearu.length > 0) {\n                dearuList.push({\n                    node: node,\n                    matches: retDearu\n                });\n            }\n        },\n        [`${Syntax.List}:exit`](node) {\n            countingPoint(withPointList, withoutPointList);\n\n            countingDesumasuDearu(desumasuList, dearuList);\n        }\n    };\n};\n"],"mappings":"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","ignoreList":[]}