{"version":3,"file":"1.1.5.js","names":["_analyzeDesumasuDearu","require","module","exports","context","Syntax","RuleError","report","getSource","desumasuList","dearuList","resetState","imagePaddingLet","reportResult","list","desumasu","dearu","forEach","node","matches","match","message","value","line","lineNumber","column","columnIndex","Document","Image","text","alt","undefined","retDesumasu","analyzeDesumasu","length","push","retDearu","analyzeDearu","desumasuCount","reduce","count","dearuCount"],"sources":["../src/1.1.5.js"],"sourcesContent":["// LICENSE : MIT\n\"use strict\";\n/*\n1.1.5.図表のキャプション\n文章の内容に応じて、敬体、常体、体言止めを使います。\nいずれの場合も、複数の文体をできるだけ混在させないことが重要です。\n通常、文末に句点(。)を付けませんが、複数の文章になる場合は句点を使用します。\n\nキャプション間で文体が混ざっていないことを確認する。\n */\nimport { analyzeDesumasu, analyzeDearu } from \"analyze-desumasu-dearu\";\nmodule.exports = function (context) {\n    let { Syntax, RuleError, report, getSource } = context;\n    let desumasuList = [];\n    let dearuList = [];\n\n    function resetState() {\n        desumasuList = [];\n        dearuList = [];\n    }\n\n    const imagePaddingLet = 2; // ![ の分paddingを付ける\n    function reportResult(list, { desumasu, dearu }) {\n        list.forEach(({ node, matches }) => {\n            matches.forEach((match) => {\n                let message;\n                if (desumasu) {\n                    message = `図表のキャプションを敬体(ですます調)に統一して下さい。\\n図表のキャプション内で敬体、常体を混在させないことが重要です。\\n\"${match.value}\"が常体(である調)です。`;\n                } else if (dearu) {\n                    message = `図表のキャプションを常体(である調)に統一して下さい。\\n図表のキャプション内で敬体、常体を混在させないことが重要です。\\n\"${match.value}\"が敬体(ですます調)です。`;\n                }\n                report(\n                    node,\n                    new RuleError(message, {\n                        line: match.lineNumber - 1,\n                        column: match.columnIndex + imagePaddingLet\n                    })\n                );\n            });\n        });\n    }\n\n    return {\n        [Syntax.Document]: resetState,\n        [Syntax.Image](node) {\n            let text = node.alt;\n            // alt がない場合は無視する\n            if (text === undefined || text === null) {\n                return;\n            }\n            let retDesumasu = analyzeDesumasu(text);\n            if (retDesumasu.length > 0) {\n                desumasuList.push({\n                    node: node,\n                    matches: retDesumasu\n                });\n            }\n            let retDearu = analyzeDearu(text);\n            if (retDearu.length > 0) {\n                dearuList.push({\n                    node: node,\n                    matches: retDearu\n                });\n            }\n        },\n        [`${Syntax.Document}:exit`]() {\n            let desumasuCount = desumasuList.reduce((count, { matches }) => count + matches.length, 0);\n            let dearuCount = dearuList.reduce((count, { matches }) => count + matches.length, 0);\n            if (desumasuCount === 0 || dearuCount === 0) {\n                return;\n            }\n            if (desumasuCount > dearuCount) {\n                reportResult(dearuList, {\n                    desumasu: true\n                });\n            } else if (desumasuCount < dearuCount) {\n                reportResult(desumasuList, {\n                    dearu: true\n                });\n            } else {\n                reportResult(dearuList, {\n                    desumasu: true\n                });\n            }\n        }\n    };\n};\n"],"mappings":"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","ignoreList":[]}